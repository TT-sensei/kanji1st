<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>かんじマスター（しゅうせいばん）</title>
    <script src="https://cdn.jsdelivr.net/npm/hanzi-writer@3.5/dist/hanzi-writer.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Mochiy+Pop+One&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Mochiy Pop One', sans-serif;
            background-color: #FFF3E0;
            color: #4E342E;
            text-align: center;
            margin: 0; padding: 20px;
        }
        h1 { margin: 10px 0; color: #BF360C; }
        
        /* リスト画面 */
        #list-view { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; }
        .card {
            background: white; width: 60px; height: 60px;
            font-size: 2rem; border-radius: 10px;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; box-shadow: 0 4px #D7CCC8; border: 2px solid #FFF;
        }
        .card:active { transform: translateY(2px); box-shadow: 0 2px #D7CCC8; }

        /* 練習画面 */
        #practice-view { display: none; flex-direction: column; align-items: center; }
        .active-view { display: flex !important; }
        
        #writer-area {
            background: white; border-radius: 20px;
            box-shadow: 0 5px #B0BEC5; margin: 20px;
        }
        button {
            padding: 10px 20px; font-size: 1.2rem;
            background: #607D8B; color: white; border: none;
            border-radius: 20px; cursor: pointer; margin: 10px;
        }
    </style>
</head>
<body>

    <div id="list-view" class="active-view">
        <h1 style="width:100%;">かんじをえらんでね</h1>
        </div>

    <div id="practice-view">
        <h1 id="current-reading">よみ</h1>
        <div id="writer-area"></div>
        <button onclick="showList()">もどる</button>
        <button onclick="retry()" style="background:#FF9800;">書きなおす</button>
    </div>

    <script>
        // データ（エラーの原因になりやすい記号を減らしています）
        const data = [
            {c:'一',r:'イチ・イツ / ひと-つ'}, {c:'二',r:'ニ / ふた-つ'}, {c:'三',r:'サン / みっ-つ'},
            {c:'四',r:'シ / よん'}, {c:'五',r:'ゴ / いつ-つ'}, {c:'六',r:'ロク / むっ-つ'},
            {c:'七',r:'シチ / なな'}, {c:'八',r:'ハチ / やっ-つ'}, {c:'九',r:'キュウ / ここの-つ'},
            {c:'十',r:'ジュウ / とお'}, {c:'人',r:'ジン / ひと'}, {c:'日',r:'ニチ / ひ'},
            {c:'月',r:'ゲツ / つき'}, {c:'火',r:'カ / ひ'}, {c:'水',r:'スイ / みず'},
            {c:'木',r:'モク / き'}, {c:'金',r:'キン / かね'}, {c:'土',r:'ド / つち'},
            {c:'上',r:'ジョウ / うえ'}, {c:'下',r:'カ / した'}, {c:'左',r:'サ / ひだり'},
            {c:'右',r:'ウ / みぎ'}, {c:'中',r:'チュウ / なか'}, {c:'大',r:'ダイ / おお-きい'},
            {c:'小',r:'ショウ / ちい-さい'}, {c:'山',r:'サン / やま'}, {c:'川',r:'セン / かわ'},
            {c:'田',r:'デン / た'}, {c:'口',r:'コウ / くち'}, {c:'目',r:'モク / め'},
            {c:'耳',r:'ジ / みみ'}, {c:'手',r:'シュ / て'}, {c:'足',r:'ソク / あし'},
            {c:'力',r:'リョク / ちから'}, {c:'女',r:'ジョ / おんな'}, {c:'男',r:'ダン / おとこ'},
            {c:'子',r:'シ / こ'}, {c:'学',r:'ガク / まな-ぶ'}, {c:'校',r:'コウ'},
            {c:'先',r:'セン / さき'}, {c:'生',r:'セイ / い-きる'}, {c:'名',r:'メイ / な'},
            {c:'字',r:'ジ / あざ'}, {c:'文',r:'ブン / ふみ'}, {c:'本',r:'ホン / もと'},
            {c:'正',r:'セイ / ただ-しい'}, {c:'白',r:'ハク / しろ'}, {c:'青',r:'セイ / あお'},
            {c:'赤',r:'セキ / あか'}, {c:'花',r:'カ / はな'}, {c:'草',r:'ソウ / くさ'},
            {c:'林',r:'リン / はやし'}, {c:'森',r:'シン / もり'}, {c:'空',r:'クウ / そら'},
            {c:'天',r:'テン / あめ'}, {c:'雨',r:'ウ / あめ'}, {c:'石',r:'セキ / いし'},
            {c:'車',r:'シャ / くるま'}, {c:'音',r:'オン / おと'}, {c:'円',r:'エン / まる'},
            {c:'王',r:'オウ'}, {c:'玉',r:'ギョク / たま'}, {c:'虫',r:'チュウ / むし'},
            {c:'町',r:'チョウ / まち'}, {c:'村',r:'ソン / むら'}, {c:'竹',r:'チク / たけ'},
            {c:'早',r:'ソウ / はや-い'}, {c:'立',r:'リツ / た-つ'}, {c:'見',r:'ケン / み-る'},
            {c:'貝',r:'バイ / かい'}, {c:'気',r:'キ'}, {c:'休',r:'キュウ / やす-む'},
            {c:'糸',r:'シ / いと'}, {c:'入',r:'ニュウ / はい-る'}, {c:'出',r:'シュツ / で-る'},
            {c:'犬',r:'ケン / いぬ'}, {c:'夕',r:'セキ / ゆう'}, {c:'千',r:'セン / ち'},
            {c:'百',r:'ヒャク'}, {c:'年',r:'ネン / とし'}
        ];

        let writer = null;
        let currentItem = null;

        // リストを作る
        const listDiv = document.getElementById('list-view');
        data.forEach(item => {
            const btn = document.createElement('div');
            btn.className = 'card';
            btn.innerText = item.c;
            btn.onclick = () => startPractice(item);
            listDiv.appendChild(btn);
        });

        function startPractice(item) {
            currentItem = item;
            document.getElementById('list-view').classList.remove('active-view');
            document.getElementById('practice-view').classList.add('active-view');
            
            document.getElementById('current-reading').innerText = item.c + ' (' + item.r + ')';
            
            // 書き順エリアのリセット
            const area = document.getElementById('writer-area');
            area.innerHTML = '';

            // HanziWriterの設定
            writer = HanziWriter.create('writer-area', item.c, {
                width: 300, height: 300, padding: 10,
                showOutline: true,
                strokeAnimationSpeed: 1,
                delayBetweenStrokes: 200,
                charDataLoader: (char, onComplete) => {
                    // データ取得（失敗時の予備動作付き）
                    fetch(`https://cdn.jsdelivr.net/gh/chanind/hanzi-writer-data-jp@master/data/${char}.json`)
                        .then(res => res.json())
                        .then(json => onComplete(json))
                        .catch(() => {
                            // 日本語データがない場合は中国語データで代用
                            fetch(`https://cdn.jsdelivr.net/npm/hanzi-writer-data@2.0/${char}.json`)
                            .then(res => res.json())
                            .then(json => onComplete(json));
                        });
                }
            });
            
            writer.quiz();
        }

        function retry() {
            if(writer) writer.quiz();
        }

        function showList() {
            document.getElementById('practice-view').classList.remove('active-view');
            document.getElementById('list-view').classList.add('active-view');
        }
    </script>
</body>
</html>
