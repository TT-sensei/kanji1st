<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1ねんせい かんじコレクション</title>
    <script src="https://cdn.jsdelivr.net/npm/hanzi-writer@3.5/dist/hanzi-writer.min.js"></script>
    <style>
        body {
            font-family: "Hiragino Kaku Gothic ProN", "Noto Sans JP", sans-serif;
            background-color: #E0F7FA;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 {
            color: #006064;
            margin: 15px 0;
            font-size: 1.5rem;
            text-align: center;
        }

        /* --- 画面切り替え用の設定 --- */
        .screen {
            display: none; /* 基本は非表示 */
            width: 100%;
            max-width: 600px;
            flex-direction: column;
            align-items: center;
            padding-bottom: 50px;
        }

        .screen.active {
            display: flex; /* activeクラスがついた画面だけ表示 */
        }

        /* --- 一覧画面（リスト）のスタイル --- */
        .kanji-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
            gap: 10px;
            width: 90%;
            padding: 10px;
        }

        .kanji-card {
            background: white;
            border-radius: 10px;
            aspect-ratio: 1 / 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: #333;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            position: relative; /* 星の位置合わせ用 */
            border: 3px solid transparent;
            transition: transform 0.1s;
        }

        .kanji-card:active {
            transform: scale(0.95);
        }

        .kanji-card.completed {
            border-color: #FFD700; /* クリアしたら枠が金になる */
            background-color: #FFFDE7;
        }

        /* 星マーク */
        .star-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            font-size: 1.2rem;
            display: none; /* 最初は隠す */
        }

        .kanji-card.completed .star-badge {
            display: block; /* クリア済みなら表示 */
        }

        /* --- 練習画面のスタイル --- */
        .practice-area {
            background: white;
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
            margin: 20px 0;
            border: 5px solid #4DD0E1;
            position: relative;
        }

        #character-target-div {
            width: 300px;
            height: 300px;
            border: 2px dashed #B2EBF2;
            background-color: #FAFAFA;
        }

        .reading-display {
            font-size: 1.5rem;
            color: #00838F;
            margin-bottom: 10px;
            font-weight: bold;
        }

        #status-msg {
            height: 2rem;
            font-size: 1.2rem;
            font-weight: bold;
            color: #006064;
            text-align: center;
            margin-bottom: 10px;
        }

        /* ボタン類 */
        button {
            padding: 10px 20px;
            font-size: 1rem;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px;
            box-shadow: 0 3px 5px rgba(0,0,0,0.2);
        }

        button.back-btn {
            background-color: #78909C;
            color: white;
            align-self: flex-start;
            margin-left: 20px;
        }

        button.reset-btn {
            background-color: #FF7043;
            color: white;
        }

        /* データ削除ボタン（小さく下に配置） */
        .data-reset {
            margin-top: 30px;
            font-size: 0.8rem;
            color: #aaa;
            background: none;
            border: 1px solid #ccc;
            box-shadow: none;
        }

    </style>
</head>
<body>

    <h1>1ねんせい かんじコレクション</h1>

    <div id="list-screen" class="screen active">
        <div style="text-align: center; margin-bottom: 10px;">
            あつめた星： <span id="star-count" style="font-size:1.5rem; color:#FF8F00; font-weight:bold;">0</span> / 80
        </div>
        <div class="kanji-grid" id="kanji-grid">
            </div>

        <button class="data-reset" onclick="clearData()">せーブデータをけす</button>
    </div>

    <div id="practice-screen" class="screen">
        <button class="back-btn" onclick="goBack()">＜ もどる</button>
        
        <div style="text-align: center; margin-top:10px;">
            <div id="current-reading" class="reading-display"></div>
        </div>

        <div class="practice-area">
            <div id="character-target-div"></div>
        </div>

        <div id="status-msg">なぞってみよう！</div>

        <div>
            <button class="reset-btn" onclick="retry()">かきなおす</button>
        </div>
    </div>

    <script>
        // 漢字データ（80文字）
        const kanjiData = [
            { char: '一', reading: 'いち' }, { char: '右', reading: 'みぎ' },
            { char: '雨', reading: 'あめ' }, { char: '円', reading: 'えん' },
            { char: '王', reading: 'おう' }, { char: '音', reading: 'おと' },
            { char: '下', reading: 'した' }, { char: '火', reading: 'ひ' },
            { char: '花', reading: 'はな' }, { char: '貝', reading: 'かい' },
            { char: '学', reading: 'まなぶ' }, { char: '気', reading: 'き' },
            { char: '九', reading: 'きゅう' }, { char: '休', reading: 'やすむ' },
            { char: '玉', reading: 'たま' }, { char: '金', reading: 'かね' },
            { char: '空', reading: 'そら' }, { char: '月', reading: 'つき' },
            { char: '犬', reading: 'いぬ' }, { char: '見', reading: 'みる' },
            { char: '五', reading: 'ご' }, { char: '口', reading: 'くち' },
            { char: '校', reading: 'こう' }, { char: '左', reading: 'ひだり' },
            { char: '三', reading: 'さん' }, { char: '山', reading: 'やま' },
            { char: '子', reading: 'こ' }, { char: '四', reading: 'よん' },
            { char: '糸', reading: 'いと' }, { char: '字', reading: 'じ' },
            { char: '耳', reading: 'みみ' }, { char: '七', reading: 'なな' },
            { char: '車', reading: 'くるま' }, { char: '手', reading: 'て' },
            { char: '十', reading: 'じゅう' }, { char: '出', reading: 'でる' },
            { char: '女', reading: 'おんな' }, { char: '小', reading: 'ちいさい' },
            { char: '上', reading: 'うえ' }, { char: '森', reading: 'もり' },
            { char: '人', reading: 'ひと' }, { char: '水', reading: 'みず' },
            { char: '正', reading: 'ただしい' }, { char: '生', reading: 'いきる' },
            { char: '青', reading: 'あお' }, { char: '夕', reading: 'ゆう' },
            { char: '石', reading: 'いし' }, { char: '赤', reading: 'あか' },
            { char: '千', reading: 'せん' }, { char: '川', reading: 'かわ' },
            { char: '先', reading: 'さき' }, { char: '早', reading: 'はやい' },
            { char: '草', reading: 'くさ' }, { char: '足', reading: 'あし' },
            { char: '村', reading: 'むら' }, { char: '大', reading: 'おおきい' },
            { char: '男', reading: 'おとこ' }, { char: '竹', reading: 'たけ' },
            { char: '中', reading: 'なか' }, { char: '虫', reading: 'むし' },
            { char: '町', reading: 'まち' }, { char: '天', reading: 'てん' },
            { char: '田', reading: 'た' }, { char: '土', reading: 'つち' },
            { char: '二', reading: 'に' }, { char: '日', reading: 'ひ' },
            { char: '入', reading: 'はいる' }, { char: '年', reading: 'とし' },
            { char: '白', reading: 'しろ' }, { char: '八', reading: 'はち' },
            { char: '百', reading: 'ひゃく' }, { char: '文', reading: 'ぶん' },
            { char: '木', reading: 'き' }, { char: '本', reading: 'ほん' },
            { char: '名', reading: 'な' }, { char: '目', reading: 'め' },
            { char: '立', reading: 'たつ' }, { char: '力', reading: 'ちから' },
            { char: '林', reading: 'はやし' }, { char: '六', reading: 'ろく' }
        ];

        // セーブデータの読み込み（ブラウザに保存されたデータを取得）
        let progressData = JSON.parse(localStorage.getItem('kanjiAppProgress')) || {};

        let writer;
        let currentCharObj = null;

        // 初期化：一覧画面を作る
        function initList() {
            const grid = document.getElementById('kanji-grid');
            grid.innerHTML = ''; // クリア
            let starCount = 0;

            kanjiData.forEach(item => {
                const card = document.createElement('div');
                card.className = 'kanji-card';
                card.innerText = item.char;
                
                // 星マークの要素
                const star = document.createElement('div');
                star.className = 'star-badge';
                star.innerText = '⭐';
                card.appendChild(star);

                // すでにクリア済みかチェック
                if (progressData[item.char]) {
                    card.classList.add('completed');
                    starCount++;
                }

                // クリックしたら練習画面へ
                card.onclick = () => startPractice(item);
                grid.appendChild(card);
            });

            document.getElementById('star-count').innerText = starCount;
        }

        // 練習画面を開始する
        function startPractice(charObj) {
            currentCharObj = charObj;
            
            // 画面切り替え
            document.getElementById('list-screen').classList.remove('active');
            document.getElementById('practice-screen').classList.add('active');

            // UI設定
            document.getElementById('current-reading').innerText = `${charObj.char} （${charObj.reading}）`;
            document.getElementById('status-msg').innerText = "なぞってみよう！";
            document.getElementById('status-msg').style.color = "#006064";

            // 描画エリアの準備
            document.getElementById('character-target-div').innerHTML = '';
            
            writer = HanziWriter.create('character-target-div', charObj.char, {
                width: 300,
                height: 300,
                padding: 10,
                showOutline: true,
                strokeAnimationSpeed: 1,
                delayBetweenStrokes: 200,
                radicalColor: '#168F16',
                drawingWidth: 20, 
                highlightColor: '#FF7043',
            });

            startQuiz();
        }

        function startQuiz() {
            writer.quiz({
                onMistake: function(strokeData) {
                    document.getElementById('status-msg').innerText = "おしい！ここだよ！";
                    document.getElementById('status-msg').style.color = "#D32F2F";
                    writer.animateStroke(strokeData.strokeNum);
                },
                onCorrectStroke: function(strokeData) {
                    document.getElementById('status-msg').innerText = "いいね！";
                    document.getElementById('status-msg').style.color = "#388E3C";
                },
                onComplete: function(summaryData) {
                    document.getElementById('status-msg').innerText = "やったー！せいかい！⭐";
                    document.getElementById('status-msg').style.color = "#FF8F00";
                    
                    // --- ここでセーブ ---
                    saveProgress(currentCharObj.char);
                }
            });
        }

        // データを保存する関数
        function saveProgress(char) {
            progressData[char] = true;
            localStorage.setItem('kanjiAppProgress', JSON.stringify(progressData));
            // 1秒後に一覧に戻る（オプション）
            setTimeout(goBack, 1500); 
        }

        // 一覧に戻る
        function goBack() {
            document.getElementById('practice-screen').classList.remove('active');
            document.getElementById('list-screen').classList.add('active');
            initList(); // 一覧を再描画して星を反映
        }

        function retry() {
            startQuiz();
        }

        // データを全消去（デバッグ用・親御さん用）
        function clearData() {
            if(confirm('ほんとうに 星を ぜんぶ 消しますか？')) {
                localStorage.removeItem('kanjiAppProgress');
                progressData = {};
                initList();
            }
        }

        // 開始
        window.onload = initList;

    </script>
</body>
</html>
